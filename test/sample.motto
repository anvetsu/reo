types:['i 'i 'i "yyyy-MM-dd 00:00:00" 's 's 's 's 'f 'f 'i]
csvopts:dict('delim \tab 'types types)
orders:csv("db/orders.txt" csvopts)
types:['i 'i 'i "yyyy-MM-dd 00:00:00" "yyyy-MM-dd 00:00:00" 'f 'i 'f]
csvopts:assoc(csvopts 'types types)
orderlines:csv("db/orderlines.txt" csvopts)
['tables ['orders, 'orderlines]]

pts:counts(orders('paymenttype))
["Order by PaymentTypes", pts]
ords_by_code:fn(c) count_eq(c orders('paymenttype))

tpgrp:fn(a b) group(fn(tp c) if {a <= tp & tp < b c+1 c}, 0 orders('totalprice), orders('paymenttype))
[["0-10" tpgrp(0 10)] ["10-100" tpgrp(10 100)] ["100-1000" tpgrp(100 1000)]]

zipords:group(fn(nord, _) nord+1, 0, orders('numorders), orders('zipcode))

op:counts(orderlines('productid))
["Products" op]

numprods:count_group(orderlines('orderlineid), orderlines('productid))
numords:fn(prodcount) {prods:filter(fn(x) x(1) = prodcount, op)
                       pids:keys(prods)
		       [count(pids) mn(pids) mx(pids)]}
ords:collect_once(fn(i) numords(i), vals(op))
sort(fn(x y) x(0) < y(0), ords)