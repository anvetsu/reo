"data files: https://github.com/AllenDowney/ThinkStats2/tree/master/workshop"
d:dct("./2002FemPreg.dct" "./2002FemPreg.dat.gz")

;; set agepreg to floats
nilzero:fn(x) if {not(x) 0 x}
ap:nilzero~d('agepreg)
ap2:ap/100.0
d2:assoc(d 'agepreg ap2)

xs:replc(d('birthwgt_lb) [97 98 99] nan)
ys:replc(d('birthwgt_oz) [97 98 99] nan)
zs:d('birthwgt_lb)+d('birthwgt_oz)/16.0
d2:assoc(d2 'birthwgt_lb xs 'birthwgt_oz ys 'totalwgt_lb zs)

sort(group_count(d2('outcome)))
sort(group_count(d2('birthwgt_lb)))

xs:d2('birthwgt_lb)
d2:assoc(d2 'birthwgt_lb replcf(xs ^X1>20 nan))

mkpregmap:fn(t) collect(conj(X1 X2) [] t('caseid))
pregmap:mkpregmap(d2)
d2('outcome)~pregmap("10229") "=> [4 4 4 4 4 4 1]"
