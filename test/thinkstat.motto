"data files: https://github.com/AllenDowney/ThinkStats2/tree/master/workshop"
d:dct("./2002FemPreg.dct" "./2002FemPreg.dat.gz")

;; set agepreg to floats
nilzero:fn(x) if {not(x) 0 x}
ap:nilzero~d('agepreg)
ap2:ap/100.0
d2:assoc(d 'agepreg ap2)

xs:replc(d('birthwgt_lb) [97 98 99] nan)
ys:replc(d('birthwgt_oz) [97 98 99] nan)
zs:d('birthwgt_lb)+d('birthwgt_oz)/16.0
d2:assoc(d2 'birthwgt_lb xs 'birthwgt_oz ys 'totalwgt_lb zs)

sort(group_count(d2('outcome)))
sort(group_count(d2('birthwgt_lb)))

xs:d2('birthwgt_lb)
d2:assoc(d2 'birthwgt_lb replcf(xs ^X1>20 nan))

mkpregmap:fn(t) collect(^conj(X1 X2) [] t('caseid))
pregmap:mkpregmap(d2)
d2('outcome)~pregmap("10229") "=> [4 4 4 4 4 4 1]"

ppl:['eye 'hair 'count]$[name~['green 'hazel 'green 'green 'blue 'green 'brown
                          'blue 'blue 'brown 'blue 'brown 'brown 'hazel
                          'hazel 'hazel]
                         name~['black 'red 'blond 'brown 'black 'red 'black 'blond
                          'brown 'blond 'red 'brown 'red 'black 'blond 'brown]
                         [5/2 7 8 29/2 10 7 34 47 42 7/2 17/2 119/2 13 15/2 5 27]]
chart('bar ppl('hair) ppl('count) ['groupby:ppl('eye) 'legend:1b])

males:[140 145 160 190 155 165 150 190 195 138 160 155 153
       145 170 175 175 170 180 135 170 157 130 185 190 155
       170 155 215 150 145 155 150 155 150 180 160 135 160
       130 155 150 148 155 150 140 180 190 145 150 164 140
       142 136 123 155]
females:[140 120 130 138 121 125 116 145 150 112 125 130 120 130
         131 120 118 125 135 125 118 122 115 102 115 150 110 116
         108 95 125 133 110 150 108 155]
all:males#females
mean(all)
median(all)
