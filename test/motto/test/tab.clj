(ns motto.test.tab
  (:use [clojure.test]
        [motto.test.util]))

(def ^:private basic-data
  ["a:tab(['a 'b 'c] [10 20 30])" 'a
   "a('a)" 10
   "a:tab(['a 'b 'c] [[10 20 30] [100 200 300] [40 50 60 70]])" 'a
   "a('b)(2)" 300
   "a:tab([dict('a 10 'b 20 'c 30) dict('a 100 'b 200 'c 300)])" 'a
   "a('a)(1)" 100
   "tab([6 2] [4210 3121 4807 4284 3609 7543 5712 2601 2305 3364 4568 2784])"
   [[[4210 3121][4807 4284][3609 7543][5712 2601][2305 3364][4568 2784]]]
   "tab([3 3] [12 56 78 74 85 96 30 22 44 66 82 27])"
   [[[12 56 78][74 85 96][30 22 44]]]
   "tab([3 4] inf(0))"
   [[[0 0 0 0][0 0 0 0][0 0 0 0]]]
   "tab([3 9] [12 56 78 74 85 96 30 22 44 66 82 27])"
   [[[12 56 78 74 85 96 30 22 44][66 82 27 12 56 78 74 85 96][30 22 44 66 82 27 12 56 78]]]
   "tab([30] [1 5 0 0])"
   [[1 5 0 0 1 5 0 0 1 5 0 0 1 5 0 0 1 5 0 0 1 5 0 0 1 5 0 0 1 5]]
   "tab([3 4] [2 4 6 8])"
   [[[2 4 6 8]
     [2 4 6 8]
     [2 4 6 8]]]
   "tab([5 5] [1 0 0 0 0 0])"
   [[[1 0 0 0 0]
     [0 1 0 0 0]
     [0 0 1 0 0]
     [0 0 0 1 0]
     [0 0 0 0 1]]]
   "tab([5 2 12] [26 16 22 17 21 44 25 22 23 44 41 33 43 36 47 49 30 22 57 20 45 60 43 22 44 21 58 57 17 43 47 17 43 26 53 23 29 19 23 38 53 47 38 22 40 57 35 26 37 27 53 26 29 46 25 26 30 20 32 16 56 55 25 47 38 27 39 59 20 28 42 25 21 57 55 44 16 54 26 16 55 56 45 45 16 55 26 20 27 55 36 39 43 38 50 16 27 23 56 41 53 60 39 47 44 47 17 28 24 35 61 26 22 35 24 20 31 35 47 37])"
   [[[[26 16 22 17 21 44 25 22 23 44 41 33]
      [43 36 47 49 30 22 57 20 45 60 43 22]]
     [[44 21 58 57 17 43 47 17 43 26 53 23]
      [29 19 23 38 53 47 38 22 40 57 35 26]]
     [[37 27 53 26 29 46 25 26 30 20 32 16]
      [56 55 25 47 38 27 39 59 20 28 42 25]]
     [[21 57 55 44 16 54 26 16 55 56 45 45]
      [16 55 26 20 27 55 36 39 43 38 50 16]]
     [[27 23 56 41 53 60 39 47 44 47 17 28]
      [24 35 61 26 22 35 24 20 31 35 47 37]]]]])

(deftest basic
  (test-with basic-data))

(def ^:private club-data
  ["a:tab(['a 'b] [[10 20] [30 40]])" 'a
   "b:tab(['a 'c] [[100 200] [300 400]])" 'b
   "c:club(a, b)" 'c
   "cols(c)" #{'a 'b 'c}
   "c('a)" [100 200]
   "c('c)" [300 400]
   "c('b)" [30 40]
   "c:club(b a)" 'c
   "cols(c)" #{'a 'b 'c}
   "c('a)" [10 20]
   "c('c)" [300 400]
   "c('b)" [30 40]])

(deftest club-test
  (test-with club-data))

(def ^:private csv-data
  ["emp:csv(\"test/data/emp.csv\")" 'emp
   "count(cols(emp))" 3
   "emp('Name)(0)" "Tom. G"
   "sum(map(parse, emp('Salary)))" 12623.76
   "cfg:dict('types ['s 'i 'd])" 'cfg
   "emp:csv(\"test/data/emp.csv\" cfg)" 'emp
   "emp('Dept)(1)" 2
   "sum(emp('Salary))" 12623.76
   "cfg:dict('headers ['n 'd 's], 'delim \\:)" 'cfg
   "emp:csv(\"test/data/emp2.csv\", cfg)" 'emp
   "cols(emp)" #{'n 'd 's}
   "emp('d)(2)" "3"])

(deftest csvtests
  (test-with csv-data))
